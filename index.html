<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××™×¦×¨ ××ª×›×•× ×™× AI + ×¨×©×™××ª ×§× ×™×•×ª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #ff6b6b;
            --secondary-color: #4ecdc4;
            --accent-color: #ffe66d;
            --dark-bg: #2d3436;
            --light-bg: #f8f9fa;
            --text-dark: #2d3436;
            --text-light: #6c757d;
            --success: #51cf66;
            --danger: #ff6b6b;
            --ai-purple: #9b59b6;
            --google-blue: #4285f4;
            --shopping-orange: #ff9500;
            --shadow: 0 8px 30px rgba(0,0,0,0.12);
            --shadow-hover: 0 12px 40px rgba(0,0,0,0.18);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: 'ğŸ³';
            position: absolute;
            font-size: 200px;
            opacity: 0.1;
            top: -50px;
            right: -50px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        .header .ai-badge {
            display: inline-block;
            background: var(--google-blue);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-top: 5px;
            font-weight: 600;
        }

        .header .free-badge {
            display: inline-block;
            background: #4caf50;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-top: 5px;
            margin-right: 10px;
            font-weight: 600;
        }

        .header .shopping-badge {
            display: inline-block;
            background: var(--shopping-orange);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-top: 5px;
            margin-right: 10px;
            font-weight: 600;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.95;
            position: relative;
            z-index: 1;
            margin-top: 10px;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            background: var(--dark-bg);
            border-bottom: 3px solid var(--primary-color);
        }

        .nav-tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            background: var(--dark-bg);
            font-size: 1.1em;
            font-weight: 600;
            position: relative;
        }

        .nav-tab:hover {
            background: #3d4446;
        }

        .nav-tab.active {
            background: white;
            color: var(--primary-color);
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary-color);
        }

        .shopping-badge-count {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--shopping-orange);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: 700;
        }

        /* Content Area */
        .content {
            padding: 30px;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* AI Recognition Section */
        .ai-recognition-section {
            background: linear-gradient(135deg, var(--google-blue) 0%, #34a853 100%);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            color: white;
            box-shadow: var(--shadow);
        }

        .api-key-section {
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .api-key-input {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            font-size: 1em;
            margin-top: 10px;
            background: rgba(255, 255, 255, 0.9);
        }

        .api-key-input:focus {
            outline: none;
            border-color: white;
        }

        .ai-upload-area {
            background: rgba(255, 255, 255, 0.15);
            border: 3px dashed rgba(255, 255, 255, 0.5);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            margin-top: 20px;
        }

        .ai-upload-area:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.8);
            transform: scale(1.02);
        }

        .ai-upload-area.analyzing {
            border-color: var(--accent-color);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .ai-preview-image {
            max-width: 400px;
            max-height: 400px;
            margin: 20px auto;
            border-radius: 15px;
            display: none;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .ai-preview-image.show {
            display: block;
        }

        .ai-results {
            margin-top: 25px;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            display: none;
        }

        .ai-results.show {
            display: block;
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .ai-loading {
            display: none;
            text-align: center;
            padding: 30px;
        }

        .ai-loading.show {
            display: block;
        }

        .ai-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .ai-error {
            background: rgba(255, 107, 107, 0.2);
            border: 2px solid rgba(255, 107, 107, 0.5);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }

        .ai-error.show {
            display: block;
            animation: slideDown 0.5s ease;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-dark);
            font-size: 1em;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        /* Ingredients Section */
        .ingredients-section {
            background: var(--light-bg);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .ingredient-item {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }

        .ingredient-item input {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.95em;
        }

        .btn-remove-ingredient {
            background: var(--danger);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-remove-ingredient:hover {
            background: #ff5252;
            transform: scale(1.05);
        }

        /* Buttons */
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #ff5252;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background: #45b8b0;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-ai {
            background: var(--google-blue);
            color: white;
        }

        .btn-ai:hover {
            background: #3367d6;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #40c057;
        }

        .btn-shopping {
            background: var(--shopping-orange);
            color: white;
        }

        .btn-shopping:hover {
            background: #ff8500;
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* Image Upload */
        .image-upload-area {
            border: 3px dashed #e0e0e0;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--light-bg);
        }

        .image-upload-area:hover {
            border-color: var(--primary-color);
            background: #fff;
        }

        .image-upload-area.has-image {
            border-style: solid;
            border-color: var(--success);
        }

        .image-preview {
            max-width: 300px;
            max-height: 300px;
            margin: 20px auto;
            border-radius: 10px;
            display: none;
            box-shadow: var(--shadow);
        }

        .image-preview.show {
            display: block;
        }

        /* Recipe Cards */
        .recipes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .recipe-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .recipe-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .recipe-card-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .recipe-card-content {
            padding: 20px;
        }

        .recipe-card-title {
            font-size: 1.4em;
            color: var(--text-dark);
            font-weight: 700;
            margin-bottom: 5px;
        }

        .recipe-card-category {
            display: inline-block;
            padding: 5px 15px;
            background: var(--accent-color);
            color: var(--text-dark);
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .recipe-card-ai-badge {
            display: inline-block;
            padding: 3px 10px;
            background: var(--google-blue);
            color: white;
            border-radius: 15px;
            font-size: 0.75em;
            font-weight: 600;
            margin-right: 5px;
        }

        .recipe-card-servings {
            color: var(--text-light);
            font-size: 0.95em;
            margin-bottom: 10px;
        }

        .recipe-card-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid var(--light-bg);
        }

        .recipe-card-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .btn-view {
            background: var(--secondary-color);
            color: white;
        }

        .btn-view:hover {
            background: #45b8b0;
        }

        .btn-edit {
            background: var(--accent-color);
            color: var(--text-dark);
        }

        .btn-edit:hover {
            background: #ffd93d;
        }

        .btn-delete {
            background: var(--danger);
            color: white;
        }

        .btn-delete:hover {
            background: #ff5252;
        }

        .btn-add-to-shopping {
            background: var(--shopping-orange);
            color: white;
        }

        .btn-add-to-shopping:hover {
            background: #ff8500;
        }

        /* Filters */
        .filters-section {
            background: var(--light-bg);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .filter-group input,
        .filter-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
        }

        /* Shopping List Styles */
        .shopping-list-section {
            background: var(--light-bg);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .shopping-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .shopping-list-header h3 {
            color: var(--shopping-orange);
            font-size: 1.8em;
        }

        .shopping-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
            border-right: 4px solid var(--shopping-orange);
        }

        .shopping-item:hover {
            box-shadow: var(--shadow);
        }

        .shopping-item.checked {
            opacity: 0.6;
            text-decoration: line-through;
            border-right-color: var(--success);
        }

        .shopping-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
            accent-color: var(--success);
        }

        .shopping-item-content {
            flex: 1;
        }

        .shopping-item-name {
            font-weight: 600;
            font-size: 1.1em;
            color: var(--text-dark);
        }

        .shopping-item-quantity {
            color: var(--text-light);
            font-size: 0.95em;
        }

        .shopping-item-recipe {
            font-size: 0.85em;
            color: var(--shopping-orange);
            font-style: italic;
        }

        .shopping-item-delete {
            background: var(--danger);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .shopping-item-delete:hover {
            background: #ff5252;
            transform: scale(1.1);
        }

        .shopping-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .empty-shopping-list {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .empty-shopping-list-icon {
            font-size: 5em;
            margin-bottom: 20px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
            padding: 25px;
            position: relative;
        }

        .modal-header h2 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 2em;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 30px;
        }

        .modal-recipe-image {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
        }

        .recipe-detail-section {
            margin-bottom: 25px;
        }

        .recipe-detail-section h3 {
            font-size: 1.5em;
            color: var(--primary-color);
            margin-bottom: 15px;
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 10px;
        }

        .ingredient-list {
            list-style: none;
            padding: 0;
        }

        .ingredient-list li {
            padding: 12px;
            background: var(--light-bg);
            margin-bottom: 8px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ingredient-list li:hover {
            background: #e9ecef;
        }

        .servings-adjuster {
            display: flex;
            align-items: center;
            gap: 15px;
            background: var(--light-bg);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .servings-adjuster button {
            background: var(--primary-color);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .servings-adjuster button:hover {
            background: #ff5252;
            transform: scale(1.1);
        }

        .servings-adjuster span {
            font-size: 1.3em;
            font-weight: 700;
            color: var(--text-dark);
        }

        /* Stats */
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary-color) 0%, #ee5a6f 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .stat-card h3 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .stat-card p {
            font-size: 1.1em;
            opacity: 0.95;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .empty-state-icon {
            font-size: 5em;
            margin-bottom: 20px;
        }

        .empty-state h3 {
            font-size: 1.8em;
            color: var(--text-dark);
            margin-bottom: 10px;
        }

        /* Footer */
        .footer {
            background: var(--dark-bg);
            color: white;
            text-align: center;
            padding: 20px;
            margin-top: 30px;
        }

        .footer a {
            color: var(--accent-color);
            text-decoration: none;
            font-weight: 600;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* Print Styles */
        .print-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid var(--light-bg);
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            .nav-tabs,
            .recipe-card-actions,
            .modal-close,
            .print-section,
            .servings-adjuster,
            .shopping-actions {
                display: none !important;
            }

            .modal-content {
                box-shadow: none;
                max-height: none;
            }

            .shopping-checkbox,
            .shopping-item-delete {
                display: none !important;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .recipes-grid {
                grid-template-columns: 1fr;
            }

            .ingredient-item {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8em;
            }

            .nav-tab {
                font-size: 0.9em;
                padding: 15px 10px;
            }

            .filters-section {
                flex-direction: column;
            }

            .filter-group {
                width: 100%;
            }

            .recipe-card-actions {
                flex-wrap: wrap;
            }

            .recipe-card-btn {
                flex: 1 1 45%;
            }
        }

        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 30px;
            justify-content: flex-start;
        }

        .btn:last-child {
            margin-right: 0;
        }

        .ai-success-message {
            background: var(--success);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            display: none;
            text-align: center;
            font-weight: 600;
        }

        .ai-success-message.show {
            display: block;
            animation: slideDown 0.5s ease;
        }

        .info-box {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-right: 4px solid #4caf50;
        }

        .shopping-notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--success);
            color: white;
            padding: 15px 30px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            z-index: 2000;
            display: none;
            animation: slideDown 0.5s ease;
        }

        .shopping-notification.show {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Shopping Notification -->
    <div id="shopping-notification" class="shopping-notification"></div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ³ ××™×¦×¨ ××ª×›×•× ×™× AI + ×¨×©×™××ª ×§× ×™×•×ª</h1>
            <div>
                <span class="free-badge">×—×™× ×! ğŸ‰</span>
                <span class="ai-badge">Gemini AI</span>
                <span class="shopping-badge">ğŸ›’ ×¨×©×™××ª ×§× ×™×•×ª ×—×›××”</span>
            </div>
            <p>×–×™×”×•×™ ××•×˜×•××˜×™ + × ×™×”×•×œ ××ª×›×•× ×™× + ×¨×©×™××ª ×§× ×™×•×ª ××•×˜×•××˜×™×ª!</p>
        </div>

        <!-- Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('ai')">ğŸ¤– ×–×™×”×•×™ AI</button>
            <button class="nav-tab" onclick="switchTab('create')">â• ×™×¦×™×¨×ª ××ª×›×•×Ÿ</button>
            <button class="nav-tab" onclick="switchTab('recipes')">ğŸ“š ×”××ª×›×•× ×™× ×©×œ×™</button>
            <button class="nav-tab" onclick="switchTab('shopping')" style="position: relative;">
                ğŸ›’ ×¨×©×™××ª ×§× ×™×•×ª
                <span id="shopping-count-badge" class="shopping-badge-count" style="display: none;">0</span>
            </button>
            <button class="nav-tab" onclick="switchTab('categories')">ğŸ·ï¸ ×§×˜×’×•×¨×™×•×ª</button>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- AI Recognition Tab -->
            <div id="ai-tab" class="tab-content active">
                <div class="ai-recognition-section">
                    <h2>ğŸ¤– ×–×™×”×•×™ ××¨×›×™×‘×™× ××•×˜×•××˜×™ ×¢× Google Gemini</h2>
                    <p>×”×¢×œ×” ×ª××•× ×” ×•×”×‘×™× ×” ×”××œ××›×•×ª×™×ª ×ª×–×”×” ××ª ×”××¨×›×™×‘×™×!</p>
                    
                    <div class="api-key-section">
                        <h3 style="margin-bottom: 10px;">ğŸ”‘ Gemini API Key (×—×™× ×!)</h3>
                        <p style="opacity: 0.9; margin-bottom: 10px;">15 ×§×¨×™××•×ª ×‘×“×§×” - ×—×™× × ×œ×—×œ×•×˜×™×Ÿ</p>
                        <input 
                            type="password" 
                            id="api-key-input" 
                            class="api-key-input" 
                            placeholder="AIza...your-gemini-api-key..."
                        >
                        <div style="margin-top: 10px;">
                            <a href="https://makersuite.google.com/app/apikey" target="_blank" style="color: white; text-decoration: underline;">
                                ğŸ“ ×§×‘×œ API Key ×—×™× × ××›××Ÿ
                            </a>
                        </div>
                    </div>
                    
                    <div class="ai-upload-area" id="ai-upload-area" onclick="document.getElementById('ai-image-input').click()">
                        <div id="ai-upload-text">
                            <p style="font-size: 3em; margin-bottom: 10px;">ğŸ¤–ğŸ“¸</p>
                            <p style="font-size: 1.2em; font-weight: 700;">×”×¢×œ×” ×ª××•× ×” ×œ×–×™×”×•×™ ××•×˜×•××˜×™</p>
                            <p style="margin-top: 10px; opacity: 0.9;">×œ×—×¥ ×›××Ÿ ××• ×’×¨×•×¨ ×ª××•× ×”</p>
                        </div>
                        <img id="ai-preview-image" class="ai-preview-image" alt="×ª×¦×•×’×” ××§×“×™××”">
                    </div>
                    <input type="file" id="ai-image-input" accept="image/*" style="display: none;" onchange="handleAIImageUpload(event)">
                    
                    <button id="analyze-btn" class="btn btn-ai" onclick="analyzeImageWithGemini()" disabled style="margin-top: 20px;">
                        ğŸ” × ×ª×— ×ª××•× ×” ×¢× Gemini AI
                    </button>

                    <div id="ai-loading" class="ai-loading">
                        <div class="ai-spinner"></div>
                        <p style="font-size: 1.2em; font-weight: 600;">ğŸ” ×× ×ª×— ×ª××•× ×”...</p>
                        <p style="margin-top: 10px; opacity: 0.8;">×–×” ×¢×œ×•×œ ×œ×§×—×ª 10-20 ×©× ×™×•×ª</p>
                    </div>

                    <div id="ai-error" class="ai-error">
                        <h3 style="margin-bottom: 10px;">âŒ ×©×’×™××”</h3>
                        <p id="ai-error-message"></p>
                    </div>

                    <div id="ai-results" class="ai-results">
                        <h3 style="font-size: 1.3em; margin-bottom: 15px;">âœ… ×ª×•×¦××•×ª ×”×–×™×”×•×™</h3>
                        <div id="ai-results-content"></div>
                        <button class="btn btn-success" onclick="useAIResults()" style="margin-top: 20px; width: 100%;">
                            âœ¨ ×”×©×ª××© ×‘××ª×›×•×Ÿ ×–×”
                        </button>
                    </div>

                    <div id="ai-success-message" class="ai-success-message">
                        âœ… ×”××ª×›×•×Ÿ ×”×•×¢×‘×¨! ×¢×‘×•×¨ ×œ"×™×¦×™×¨×ª ××ª×›×•×Ÿ"
                    </div>
                </div>

                <div class="info-box">
                    <h4>ğŸ’¡ ×˜×™×¤×™×:</h4>
                    <ul style="margin-top: 10px; line-height: 2;">
                        <li>âœ… ×ª××•× ×•×ª ×‘×¨×•×¨×•×ª ×•××•××¨×•×ª</li>
                        <li>âœ… ×”×× ×” ×‘××¨×›×– ×”×ª××•× ×”</li>
                        <li>âœ… Google Gemini ×—×™× ××™! (15/×“×§×”)</li>
                        <li>ğŸ›’ <strong>×—×“×©!</strong> ×”×•×¡×£ ××ª×›×•× ×™× ×œ×¨×©×™××ª ×§× ×™×•×ª</li>
                    </ul>
                </div>
            </div>

            <!-- Create Recipe Tab - keeping original structure -->
            <div id="create-tab" class="tab-content">
                <form id="recipe-form" onsubmit="saveRecipe(event)">
                    <div class="form-group">
                        <label>×©× ×”××ª×›×•×Ÿ *</label>
                        <input type="text" id="recipe-name" required placeholder="×œ×“×•×’××”: ×¤×¡×˜×” ×‘×¨×•×˜×‘ ×¢×’×‘× ×™×•×ª">
                    </div>

                    <div class="form-group">
                        <label>×§×˜×’×•×¨×™×” *</label>
                        <select id="recipe-category" required>
                            <option value="">×‘×—×¨ ×§×˜×’×•×¨×™×”</option>
                            <option value="×¨××©×•× ×•×ª">ğŸ¥— ×¨××©×•× ×•×ª</option>
                            <option value="×¢×™×§×¨×™×•×ª">ğŸ– ×¢×™×§×¨×™×•×ª</option>
                            <option value="×ª×•×¡×¤×•×ª">ğŸ¥” ×ª×•×¡×¤×•×ª</option>
                            <option value="×§×™× ×•×—×™×">ğŸ° ×§×™× ×•×—×™×</option>
                            <option value="×¡×œ×˜×™×">ğŸ¥™ ×¡×œ×˜×™×</option>
                            <option value="××¨×§×™×">ğŸ² ××¨×§×™×</option>
                            <option value="××¤×™×™×”">ğŸ¥ ××¤×™×™×”</option>
                            <option value="××©×§××•×ª">ğŸ¹ ××©×§××•×ª</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>××¡×¤×¨ ×¡×•×¢×“×™× *</label>
                        <input type="number" id="recipe-servings" required min="1" max="50" value="4">
                    </div>

                    <div class="form-group">
                        <label>×–××Ÿ ×”×›× ×” (×‘×“×§×•×ª)</label>
                        <input type="number" id="recipe-prep-time" min="1" placeholder="30">
                    </div>

                    <div class="ingredients-section">
                        <h3 style="margin-bottom: 15px;">ğŸ¥• ××¨×›×™×‘×™×</h3>
                        <div id="ingredients-list"></div>
                        <button type="button" class="btn btn-secondary" onclick="addIngredient()">
                            â• ×”×•×¡×£ ××¨×›×™×‘
                        </button>
                    </div>

                    <div class="form-group">
                        <label>×”×•×¨××•×ª ×”×›× ×” *</label>
                        <textarea id="recipe-instructions" required placeholder="×ª××¨ ××ª ×©×œ×‘×™ ×”×”×›× ×”..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>×˜×™×¤×™× ×•×”×¢×¨×•×ª</label>
                        <textarea id="recipe-notes" placeholder="×˜×™×¤×™× ×©×™××•×©×™×™×..."></textarea>
                    </div>

                    <div class="form-group">
                        <label>×ª××•× ×” ×©×œ ×”××ª×›×•×Ÿ</label>
                        <div class="image-upload-area" onclick="document.getElementById('recipe-image').click()">
                            <div id="upload-text">
                                <p style="font-size: 3em; margin-bottom: 10px;">ğŸ“¸</p>
                                <p style="font-size: 1.1em; font-weight: 600;">×œ×—×¥ ×œ×”×¢×œ××ª ×ª××•× ×”</p>
                            </div>
                            <img id="image-preview" class="image-preview" alt="×ª×¦×•×’×” ××§×“×™××”">
                        </div>
                        <input type="file" id="recipe-image" accept="image/*" style="display: none;" onchange="previewImage(event)">
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">ğŸ’¾ ×©××•×¨ ××ª×›×•×Ÿ</button>
                        <button type="button" class="btn btn-secondary" onclick="resetForm()">ğŸ”„ × ×§×” ×˜×•×¤×¡</button>
                    </div>
                    <input type="hidden" id="edit-recipe-id">
                    <input type="hidden" id="ai-generated-flag">
                </form>
            </div>

            <!-- Recipes Tab -->
            <div id="recipes-tab" class="tab-content">
                <div class="stats-section">
                    <div class="stat-card">
                        <h3 id="total-recipes">0</h3>
                        <p>×¡×š ×”×›×œ ××ª×›×•× ×™×</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, var(--secondary-color) 0%, #45b8b0 100%);">
                        <h3 id="total-categories">0</h3>
                        <p>×§×˜×’×•×¨×™×•×ª</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, var(--google-blue) 0%, #34a853 100%);">
                        <h3 id="total-ai-recipes">0</h3>
                        <p>××ª×›×•× ×™× ×-AI</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, var(--shopping-orange) 0%, #ff8500 100%);">
                        <h3 id="shopping-list-count">0</h3>
                        <p>×¤×¨×™×˜×™× ×‘×¨×©×™××ª ×§× ×™×•×ª</p>
                    </div>
                </div>

                <div class="filters-section">
                    <div class="filter-group">
                        <label>ğŸ” ×—×™×¤×•×©</label>
                        <input type="text" id="search-recipes" placeholder="×—×¤×© ×œ×¤×™ ×©×..." oninput="filterRecipes()">
                    </div>
                    <div class="filter-group">
                        <label>ğŸ·ï¸ ×¡× ×Ÿ ×œ×¤×™ ×§×˜×’×•×¨×™×”</label>
                        <select id="filter-category" onchange="filterRecipes()">
                            <option value="">×›×œ ×”×§×˜×’×•×¨×™×•×ª</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>ğŸ‘¥ ××¡×¤×¨ ×¡×•×¢×“×™×</label>
                        <input type="number" id="filter-servings" placeholder="×”×›×œ" min="1" oninput="filterRecipes()">
                    </div>
                </div>

                <div id="recipes-container" class="recipes-grid"></div>
            </div>

            <!-- Shopping List Tab - NEW! -->
            <div id="shopping-tab" class="tab-content">
                <div class="shopping-list-section">
                    <div class="shopping-list-header">
                        <h3>ğŸ›’ ×¨×©×™××ª ×”×§× ×™×•×ª ×©×œ×™</h3>
                        <div class="shopping-actions">
                            <button class="btn btn-shopping" onclick="exportShoppingList()">ğŸ“¥ ×™×™×¦× ×¨×©×™××”</button>
                            <button class="btn btn-secondary" onclick="clearCheckedItems()">âœ“ × ×§×” ××¡×•×× ×™×</button>
                            <button class="btn btn-danger" onclick="clearAllShoppingList()">ğŸ—‘ï¸ × ×§×” ×”×›×œ</button>
                        </div>
                    </div>
                    <div id="shopping-list-container"></div>
                </div>
            </div>

            <!-- Categories Tab - keeping original -->
            <div id="categories-tab" class="tab-content">
                <h2 style="margin-bottom: 20px; color: var(--primary-color);">ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×•×ª ×œ×¤×™ ×§×˜×’×•×¨×™×•×ª</h2>
                <div id="categories-stats" class="recipes-grid"></div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>×¤×•×ª×— ×¢× â¤ï¸ ×¢×œ ×™×“×™ <a href="https://www.genspark.ai" target="_blank">Genspark AI</a></p>
            <p style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">
                Â© 2026 ××™×¦×¨ ××ª×›×•× ×™× AI + ×¨×©×™××ª ×§× ×™×•×ª | Powered by Google Gemini
            </p>
        </div>
    </div>

    <!-- Recipe Detail Modal -->
    <div id="recipe-modal" class="modal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <button class="modal-close" onclick="closeRecipeModal()">Ã—</button>
                <h2 id="modal-recipe-name"></h2>
                <div>
                    <span id="modal-recipe-category" class="recipe-card-category"></span>
                    <span id="modal-ai-badge" class="recipe-card-ai-badge" style="display: none;">ğŸ¤– Gemini</span>
                </div>
            </div>
            <div class="modal-body">
                <img id="modal-recipe-image" class="modal-recipe-image" alt="×ª××•× ×ª ×”××ª×›×•×Ÿ" style="display: none;">
                
                <div class="servings-adjuster">
                    <button onclick="adjustServings(-1)">-</button>
                    <span>××ª×›×•×Ÿ ×œ-<strong id="modal-current-servings"></strong> ×¡×•×¢×“×™×</span>
                    <button onclick="adjustServings(1)">+</button>
                </div>

                <div class="recipe-detail-section">
                    <h3>â±ï¸ ×¤×¨×˜×™× ×›×œ×œ×™×™×</h3>
                    <p><strong>×–××Ÿ ×”×›× ×”:</strong> <span id="modal-prep-time"></span></p>
                    <p><strong>××¡×¤×¨ ×¡×•×¢×“×™× ××§×•×¨×™:</strong> <span id="modal-original-servings"></span></p>
                </div>

                <div class="recipe-detail-section">
                    <h3>ğŸ¥• ××¨×›×™×‘×™×</h3>
                    <ul id="modal-ingredients" class="ingredient-list"></ul>
                </div>

                <div class="recipe-detail-section">
                    <h3>ğŸ‘¨â€ğŸ³ ×”×•×¨××•×ª ×”×›× ×”</h3>
                    <div id="modal-instructions" style="line-height: 1.8; white-space: pre-wrap;"></div>
                </div>

                <div class="recipe-detail-section" id="modal-notes-section" style="display: none;">
                    <h3>ğŸ’¡ ×˜×™×¤×™× ×•×”×¢×¨×•×ª</h3>
                    <div id="modal-notes" style="line-height: 1.8; white-space: pre-wrap;"></div>
                </div>

                <div class="print-section">
                    <button class="btn btn-shopping" onclick="addRecipeToShoppingList()" style="width: 100%; margin-bottom: 10px;">
                        ğŸ›’ ×”×•×¡×£ ×œ×¨×©×™××ª ×§× ×™×•×ª
                    </button>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="window.print()">ğŸ–¨ï¸ ×”×“×¤×¡</button>
                        <button class="btn btn-secondary" onclick="exportRecipe()">ğŸ“¥ ×™×™×¦×</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let recipes = JSON.parse(localStorage.getItem('recipes')) || [];
        let shoppingList = JSON.parse(localStorage.getItem('shoppingList')) || [];
        let currentRecipeId = null;
        let currentServings = 4;
        let originalServings = 4;
        let aiAnalysisResult = null;
        let currentAIImageData = null;

        const API_KEY_STORAGE = 'gemini_api_key';

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            const savedKey = localStorage.getItem(API_KEY_STORAGE);
            if (savedKey) {
                document.getElementById('api-key-input').value = savedKey;
            }

            addIngredient();
            addIngredient();
            addIngredient();
            loadRecipes();
            updateStats();
            updateCategoryFilter();
            updateCategoriesTab();
            loadShoppingList();
            updateShoppingCount();
        });

        // Save API key
        document.getElementById('api-key-input').addEventListener('input', (e) => {
            const apiKey = e.target.value.trim();
            if (apiKey) {
                localStorage.setItem(API_KEY_STORAGE, apiKey);
            }
        });

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'recipes') {
                loadRecipes();
            } else if (tabName === 'categories') {
                updateCategoriesTab();
            } else if (tabName === 'shopping') {
                loadShoppingList();
            }
        }

        // Shopping List Functions
        function addRecipeToShoppingList() {
            const recipe = recipes.find(r => r.id === currentRecipeId);
            if (!recipe) return;

            const ratio = currentServings / originalServings;
            
            recipe.ingredients.forEach(ing => {
                const adjustedQuantity = ing.quantity * ratio;
                const existingItem = shoppingList.find(item => 
                    item.name.toLowerCase() === ing.name.toLowerCase()
                );

                if (existingItem) {
                    // Combine quantities if same unit
                    if (existingItem.unit === ing.unit) {
                        existingItem.quantity += adjustedQuantity;
                    } else {
                        // Add as separate item if different unit
                        shoppingList.push({
                            id: Date.now().toString() + Math.random(),
                            name: ing.name,
                            quantity: adjustedQuantity,
                            unit: ing.unit,
                            recipeName: recipe.name,
                            checked: false
                        });
                    }
                } else {
                    shoppingList.push({
                        id: Date.now().toString() + Math.random(),
                        name: ing.name,
                        quantity: adjustedQuantity,
                        unit: ing.unit,
                        recipeName: recipe.name,
                        checked: false
                    });
                }
            });

            localStorage.setItem('shoppingList', JSON.stringify(shoppingList));
            updateShoppingCount();
            showNotification(`âœ… ${recipe.ingredients.length} ××¨×›×™×‘×™× × ×•×¡×¤×• ×œ×¨×©×™××ª ×”×§× ×™×•×ª!`);
            loadShoppingList();
        }

        function addRecipeToShoppingListFromCard(recipeId) {
            const recipe = recipes.find(r => r.id === recipeId);
            if (!recipe) return;

            recipe.ingredients.forEach(ing => {
                const existingItem = shoppingList.find(item => 
                    item.name.toLowerCase() === ing.name.toLowerCase()
                );

                if (existingItem && existingItem.unit === ing.unit) {
                    existingItem.quantity += ing.quantity;
                } else {
                    shoppingList.push({
                        id: Date.now().toString() + Math.random(),
                        name: ing.name,
                        quantity: ing.quantity,
                        unit: ing.unit,
                        recipeName: recipe.name,
                        checked: false
                    });
                }
            });

            localStorage.setItem('shoppingList', JSON.stringify(shoppingList));
            updateShoppingCount();
            showNotification(`âœ… ${recipe.name} × ×•×¡×£ ×œ×¨×©×™××ª ×”×§× ×™×•×ª!`);
            loadShoppingList();
        }

        function loadShoppingList() {
            const container = document.getElementById('shopping-list-container');
            
            if (shoppingList.length === 0) {
                container.innerHTML = `
                    <div class="empty-shopping-list">
                        <div class="empty-shopping-list-icon">ğŸ›’</div>
                        <h3>×¨×©×™××ª ×”×§× ×™×•×ª ×¨×™×§×”</h3>
                        <p>×”×•×¡×£ ××ª×›×•× ×™× ×œ×¨×©×™××” ××œ×©×•× ×™×ª "×”××ª×›×•× ×™× ×©×œ×™"</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = shoppingList.map(item => `
                <div class="shopping-item ${item.checked ? 'checked' : ''}">
                    <input 
                        type="checkbox" 
                        class="shopping-checkbox" 
                        ${item.checked ? 'checked' : ''}
                        onchange="toggleShoppingItem('${item.id}')"
                    >
                    <div class="shopping-item-content">
                        <div class="shopping-item-name">${item.name}</div>
                        <div class="shopping-item-quantity">${item.quantity.toFixed(2).replace(/\.?0+$/, '')} ${item.unit}</div>
                        <div class="shopping-item-recipe">××ª×•×š: ${item.recipeName}</div>
                    </div>
                    <button class="shopping-item-delete" onclick="removeShoppingItem('${item.id}')">Ã—</button>
                </div>
            `).join('');
        }

        function toggleShoppingItem(id) {
            const item = shoppingList.find(i => i.id === id);
            if (item) {
                item.checked = !item.checked;
                localStorage.setItem('shoppingList', JSON.stringify(shoppingList));
                loadShoppingList();
            }
        }

        function removeShoppingItem(id) {
            shoppingList = shoppingList.filter(i => i.id !== id);
            localStorage.setItem('shoppingList', JSON.stringify(shoppingList));
            updateShoppingCount();
            loadShoppingList();
        }

        function clearCheckedItems() {
            shoppingList = shoppingList.filter(i => !i.checked);
            localStorage.setItem('shoppingList', JSON.stringify(shoppingList));
            updateShoppingCount();
            loadShoppingList();
            showNotification('âœ… ×¤×¨×™×˜×™× ××¡×•×× ×™× × ××—×§×•!');
        }

        function clearAllShoppingList() {
            if (confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×›×œ ×¨×©×™××ª ×”×§× ×™×•×ª?')) {
                shoppingList = [];
                localStorage.setItem('shoppingList', JSON.stringify(shoppingList));
                updateShoppingCount();
                loadShoppingList();
                showNotification('ğŸ—‘ï¸ ×¨×©×™××ª ×”×§× ×™×•×ª × ×•×§×ª×”!');
            }
        }

        function exportShoppingList() {
            if (shoppingList.length === 0) {
                alert('×¨×©×™××ª ×”×§× ×™×•×ª ×¨×™×§×”!');
                return;
            }

            const text = `
×¨×©×™××ª ×§× ×™×•×ª - ××™×¦×¨ ××ª×›×•× ×™×
${'='.repeat(30)}

${shoppingList.map(item => `${item.checked ? 'âœ“' : 'â˜'} ${item.quantity.toFixed(2).replace(/\.?0+$/, '')} ${item.unit} ${item.name}\n  (${item.recipeName})`).join('\n\n')}

---
× ×•×¦×¨ ×¢× ××™×¦×¨ ××ª×›×•× ×™× AI
×¡×š ×”×›×œ ×¤×¨×™×˜×™×: ${shoppingList.length}
            `.trim();

            const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = '×¨×©×™××ª-×§× ×™×•×ª.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('ğŸ“¥ ×¨×©×™××ª ×”×§× ×™×•×ª ×™×•×¦××”!');
        }

        function updateShoppingCount() {
            const count = shoppingList.length;
            document.getElementById('shopping-list-count').textContent = count;
            
            const badge = document.getElementById('shopping-count-badge');
            if (count > 0) {
                badge.textContent = count;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }

        function showNotification(message) {
            const notification = document.getElementById('shopping-notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // [Rest of the original functions - keeping ALL existing functionality]
        // Handle AI image upload
        function handleAIImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                currentAIImageData = e.target.result;
                const preview = document.getElementById('ai-preview-image');
                preview.src = currentAIImageData;
                preview.classList.add('show');
                document.getElementById('ai-upload-text').style.display = 'none';
                
                const apiKey = document.getElementById('api-key-input').value.trim();
                document.getElementById('analyze-btn').disabled = !apiKey;
            };
            reader.readAsDataURL(file);
        }

        function base64ToGeminiPart(base64Data) {
            const parts = base64Data.split(',');
            const mimeType = parts[0].match(/:(.*?);/)[1];
            const base64 = parts[1];
            return {
                inline_data: {
                    mime_type: mimeType,
                    data: base64
                }
            };
        }

        async function analyzeImageWithGemini() {
            const apiKey = document.getElementById('api-key-input').value.trim();
            
            if (!apiKey) {
                showAIError('× × ×œ×”×›× ×™×¡ Gemini API Key ×ª×—×™×œ×”');
                return;
            }

            if (!currentAIImageData) {
                showAIError('× × ×œ×”×¢×œ×•×ª ×ª××•× ×” ×ª×—×™×œ×”');
                return;
            }

            document.getElementById('ai-loading').classList.add('show');
            document.getElementById('ai-error').classList.remove('show');
            document.getElementById('ai-results').classList.remove('show');
            document.getElementById('ai-upload-area').classList.add('analyzing');
            document.getElementById('analyze-btn').disabled = true;

            try {
                const imagePart = base64ToGeminiPart(currentAIImageData);
                
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                {
                                    text: `× ×ª×— ××ª ×”×ª××•× ×” ×”×–×• ×©×œ ×× ×ª ××•×›×œ ×•×–×”×”:

1. ×©× ×”×× ×” ×‘×¢×‘×¨×™×ª
2. ×§×˜×’×•×¨×™×” (×¨××©×•× ×•×ª, ×¢×™×§×¨×™×•×ª, ×ª×•×¡×¤×•×ª, ×§×™× ×•×—×™×, ×¡×œ×˜×™×, ××¨×§×™×, ××¤×™×™×”, ××©×§××•×ª)
3. ×¨×©×™××” ×©×œ 6-10 ××¨×›×™×‘×™× ×¢× ×›××•×™×•×ª ×•×™×—×™×“×•×ª
4. ×–××Ÿ ×”×›× ×” ×‘×“×§×•×ª
5. ×”×•×¨××•×ª ×”×›× ×” (4-6 ×©×œ×‘×™×)
6. ×˜×™×¤

×”×—×–×¨ JSON ×‘×¤×•×¨××˜:
{
  "name": "×©× ×”×× ×”",
  "category": "×§×˜×’×•×¨×™×”",
  "ingredients": [
    {"name": "××¨×›×™×‘", "quantity": 200, "unit": "×’×¨×"}
  ],
  "prepTime": 30,
  "instructions": "1. ×©×œ×‘\\n2. ×©×œ×‘",
  "notes": "×˜×™×¤"
}`
                                },
                                imagePart
                            ]
                        }]
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || '×©×’×™××”');
                }

                const data = await response.json();
                
                if (!data.candidates || !data.candidates[0]?.content?.parts) {
                    throw new Error('×ª×©×•×‘×” ×œ× ×ª×§×™× ×”');
                }

                const aiResponse = data.candidates[0].content.parts[0].text;
                
                let recipeData;
                try {
                    const jsonText = aiResponse.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                    recipeData = JSON.parse(jsonText);
                } catch (e) {
                    throw new Error('×œ× ×”×¦×œ×—×ª×™ ×œ×¤×¨×¡×¨. × ×¡×” ×©×•×‘.');
                }

                if (!recipeData.name || !recipeData.category || !recipeData.ingredients) {
                    throw new Error('×—×¡×¨×™× ×©×“×•×ª');
                }

                aiAnalysisResult = recipeData;
                displayAIResults(recipeData);
                document.getElementById('ai-results').classList.add('show');

            } catch (error) {
                let errorMessage = error.message;
                
                if (errorMessage.includes('API_KEY_INVALID')) {
                    errorMessage = 'API Key ×œ× ×ª×§×™×Ÿ';
                } else if (errorMessage.includes('quota')) {
                    errorMessage = '×¢×‘×¨×ª ××›×¡×”. ×—×›×” ×“×§×”';
                }
                
                showAIError(errorMessage);
            } finally {
                document.getElementById('ai-loading').classList.remove('show');
                document.getElementById('ai-upload-area').classList.remove('analyzing');
                document.getElementById('analyze-btn').disabled = false;
            }
        }

        function displayAIResults(result) {
            const content = document.getElementById('ai-results-content');
            content.innerHTML = `
                <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <p style="font-size: 1.1em; margin-bottom: 8px;"><strong>ğŸ½ï¸ ×× ×”:</strong> ${result.name}</p>
                    <p style="font-size: 1.1em; margin-bottom: 8px;"><strong>ğŸ·ï¸ ×§×˜×’×•×¨×™×”:</strong> ${result.category}</p>
                    <p style="font-size: 1.1em;"><strong>â±ï¸ ×–××Ÿ:</strong> ${result.prepTime} ×“×§×•×ª</p>
                </div>
                <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px;">
                    <p style="font-size: 1.1em; margin-bottom: 10px;"><strong>ğŸ¥• ××¨×›×™×‘×™× (${result.ingredients.length}):</strong></p>
                    <ul style="line-height: 1.8; padding-right: 20px;">
                        ${result.ingredients.map(ing => `<li>${ing.quantity} ${ing.unit} ${ing.name}</li>`).join('')}
                    </ul>
                </div>
            `;
        }

        function showAIError(message) {
            document.getElementById('ai-error-message').textContent = message;
            document.getElementById('ai-error').classList.add('show');
        }

        function useAIResults() {
            if (!aiAnalysisResult) return;

            document.getElementById('recipe-name').value = aiAnalysisResult.name;
            document.getElementById('recipe-category').value = aiAnalysisResult.category;
            document.getElementById('recipe-servings').value = 4;
            document.getElementById('recipe-prep-time').value = aiAnalysisResult.prepTime;
            document.getElementById('recipe-instructions').value = aiAnalysisResult.instructions;
            document.getElementById('recipe-notes').value = aiAnalysisResult.notes || '';
            document.getElementById('ai-generated-flag').value = 'true';

            if (currentAIImageData) {
                const recipePreview = document.getElementById('image-preview');
                recipePreview.src = currentAIImageData;
                recipePreview.classList.add('show');
                document.querySelector('.image-upload-area').classList.add('has-image');
                document.getElementById('upload-text').style.display = 'none';
            }

            document.getElementById('ingredients-list').innerHTML = '';
            aiAnalysisResult.ingredients.forEach(ing => {
                const ingredientsList = document.getElementById('ingredients-list');
                const ingredientItem = document.createElement('div');
                ingredientItem.className = 'ingredient-item';
                ingredientItem.innerHTML = `
                    <input type="text" placeholder="×©× ×”××¨×›×™×‘" class="ingredient-name" value="${ing.name}" required>
                    <input type="text" placeholder="×›××•×ª" class="ingredient-quantity" value="${ing.quantity}" required>
                    <input type="text" placeholder="×™×—×™×“×”" class="ingredient-unit" value="${ing.unit}" required>
                    <button type="button" class="btn-remove-ingredient" onclick="removeIngredient(this)">ğŸ—‘ï¸</button>
                `;
                ingredientsList.appendChild(ingredientItem);
            });

            document.getElementById('ai-success-message').classList.add('show');
            setTimeout(() => {
                document.getElementById('ai-success-message').classList.remove('show');
            }, 3000);

            setTimeout(() => {
                switchTab('create');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }, 1500);
        }

        function addIngredient() {
            const ingredientsList = document.getElementById('ingredients-list');
            const ingredientItem = document.createElement('div');
            ingredientItem.className = 'ingredient-item';
            ingredientItem.innerHTML = `
                <input type="text" placeholder="×©× ×”××¨×›×™×‘" class="ingredient-name" required>
                <input type="text" placeholder="×›××•×ª" class="ingredient-quantity" required>
                <input type="text" placeholder="×™×—×™×“×”" class="ingredient-unit" required>
                <button type="button" class="btn-remove-ingredient" onclick="removeIngredient(this)">ğŸ—‘ï¸</button>
            `;
            ingredientsList.appendChild(ingredientItem);
        }

        function removeIngredient(button) {
            const ingredientsList = document.getElementById('ingredients-list');
            if (ingredientsList.children.length > 1) {
                button.parentElement.remove();
            } else {
                alert('×—×™×™×‘ ×œ×”×™×•×ª ×œ×¤×—×•×ª ××¨×›×™×‘ ××—×“!');
            }
        }

        function previewImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('image-preview');
                    const uploadArea = document.querySelector('.image-upload-area');
                    preview.src = e.target.result;
                    preview.classList.add('show');
                    uploadArea.classList.add('has-image');
                    document.getElementById('upload-text').style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        }

        function saveRecipe(event) {
            event.preventDefault();

            const ingredients = [];
            document.querySelectorAll('.ingredient-item').forEach(item => {
                const name = item.querySelector('.ingredient-name').value;
                const quantity = item.querySelector('.ingredient-quantity').value;
                const unit = item.querySelector('.ingredient-unit').value;
                if (name && quantity && unit) {
                    ingredients.push({ name, quantity: parseFloat(quantity), unit });
                }
            });

            if (ingredients.length === 0) {
                alert('× × ×œ×”×•×¡×™×£ ×œ×¤×—×•×ª ××¨×›×™×‘ ××—×“!');
                return;
            }

            const recipe = {
                id: document.getElementById('edit-recipe-id').value || Date.now().toString(),
                name: document.getElementById('recipe-name').value,
                category: document.getElementById('recipe-category').value,
                servings: parseInt(document.getElementById('recipe-servings').value),
                prepTime: document.getElementById('recipe-prep-time').value || '×œ× ×¦×•×™×Ÿ',
                ingredients: ingredients,
                instructions: document.getElementById('recipe-instructions').value,
                notes: document.getElementById('recipe-notes').value,
                image: document.getElementById('image-preview').src || null,
                aiGenerated: document.getElementById('ai-generated-flag').value === 'true',
                createdAt: new Date().toISOString()
            };

            const existingIndex = recipes.findIndex(r => r.id === recipe.id);
            if (existingIndex > -1) {
                recipes[existingIndex] = recipe;
                alert('×”××ª×›×•×Ÿ ×¢×•×“×›×Ÿ ×‘×”×¦×œ×—×”! âœ…');
            } else {
                recipes.push(recipe);
                alert('×”××ª×›×•×Ÿ × ×©××¨ ×‘×”×¦×œ×—×”! ğŸ‰');
            }

            localStorage.setItem('recipes', JSON.stringify(recipes));
            resetForm();
            switchTab('recipes');
            loadRecipes();
            updateStats();
            updateCategoryFilter();
        }

        function resetForm() {
            document.getElementById('recipe-form').reset();
            document.getElementById('edit-recipe-id').value = '';
            document.getElementById('ai-generated-flag').value = '';
            document.getElementById('ingredients-list').innerHTML = '';
            document.getElementById('image-preview').classList.remove('show');
            document.querySelector('.image-upload-area').classList.remove('has-image');
            document.getElementById('upload-text').style.display = 'block';
            addIngredient();
            addIngredient();
            addIngredient();
        }

        function loadRecipes() {
            const container = document.getElementById('recipes-container');
            
            if (recipes.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ½ï¸</div>
                        <h3>××™×Ÿ ××ª×›×•× ×™× ×¢×“×™×™×Ÿ</h3>
                        <p>×”×ª×—×œ ×œ×™×¦×•×¨ ××ª×›×•×Ÿ ××• ×”×©×ª××© ×‘×–×™×”×•×™ AI!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = recipes.map(recipe => `
                <div class="recipe-card" onclick="viewRecipe('${recipe.id}')">
                    ${recipe.image ? `<img src="${recipe.image}" class="recipe-card-image" alt="${recipe.name}">` : '<div class="recipe-card-image"></div>'}
                    <div class="recipe-card-content">
                        <div class="recipe-card-header">
                            <div>
                                <h3 class="recipe-card-title">${recipe.name}</h3>
                                <span class="recipe-card-category">${recipe.category}</span>
                                ${recipe.aiGenerated ? '<span class="recipe-card-ai-badge">ğŸ¤– AI</span>' : ''}
                            </div>
                        </div>
                        <p class="recipe-card-servings">ğŸ‘¥ ${recipe.servings} ×¡×•×¢×“×™× | â±ï¸ ${recipe.prepTime} ×“×§×•×ª</p>
                        <p style="color: var(--text-light); font-size: 0.9em;">ğŸ¥• ${recipe.ingredients.length} ××¨×›×™×‘×™×</p>
                        <div class="recipe-card-actions">
                            <button class="recipe-card-btn btn-add-to-shopping" onclick="event.stopPropagation(); addRecipeToShoppingListFromCard('${recipe.id}')">ğŸ›’ ×§× ×™×•×ª</button>
                            <button class="recipe-card-btn btn-view" onclick="event.stopPropagation(); viewRecipe('${recipe.id}')">ğŸ‘ï¸ ×¦×¤×”</button>
                            <button class="recipe-card-btn btn-edit" onclick="event.stopPropagation(); editRecipe('${recipe.id}')">âœï¸ ×¢×¨×•×š</button>
                            <button class="recipe-card-btn btn-delete" onclick="event.stopPropagation(); deleteRecipe('${recipe.id}')">ğŸ—‘ï¸ ××—×§</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function viewRecipe(id) {
            const recipe = recipes.find(r => r.id === id);
            if (!recipe) return;

            currentRecipeId = id;
            originalServings = recipe.servings;
            currentServings = recipe.servings;

            document.getElementById('modal-recipe-name').textContent = recipe.name;
            document.getElementById('modal-recipe-category').textContent = recipe.category;
            
            const aiBadge = document.getElementById('modal-ai-badge');
            if (recipe.aiGenerated) {
                aiBadge.style.display = 'inline-block';
            } else {
                aiBadge.style.display = 'none';
            }
            
            document.getElementById('modal-current-servings').textContent = currentServings;
            document.getElementById('modal-original-servings').textContent = originalServings;
            document.getElementById('modal-prep-time').textContent = recipe.prepTime + ' ×“×§×•×ª';
            
            const modalImage = document.getElementById('modal-recipe-image');
            if (recipe.image) {
                modalImage.src = recipe.image;
                modalImage.style.display = 'block';
            } else {
                modalImage.style.display = 'none';
            }

            updateModalIngredients(recipe);
            document.getElementById('modal-instructions').textContent = recipe.instructions;
            
            const notesSection = document.getElementById('modal-notes-section');
            if (recipe.notes) {
                document.getElementById('modal-notes').textContent = recipe.notes;
                notesSection.style.display = 'block';
            } else {
                notesSection.style.display = 'none';
            }

            document.getElementById('recipe-modal').classList.add('show');
        }

        function updateModalIngredients(recipe) {
            const ratio = currentServings / originalServings;
            const ingredientsHtml = recipe.ingredients.map(ing => {
                const adjustedQuantity = (ing.quantity * ratio).toFixed(2).replace(/\.?0+$/, '');
                return `<li>
                    <span><strong>${ing.name}</strong></span>
                    <span>${adjustedQuantity} ${ing.unit}</span>
                </li>`;
            }).join('');
            document.getElementById('modal-ingredients').innerHTML = ingredientsHtml;
        }

        function adjustServings(change) {
            const recipe = recipes.find(r => r.id === currentRecipeId);
            if (!recipe) return;

            currentServings += change;
            if (currentServings < 1) currentServings = 1;
            if (currentServings > 50) currentServings = 50;

            document.getElementById('modal-current-servings').textContent = currentServings;
            updateModalIngredients(recipe);
        }

        function closeRecipeModal() {
            document.getElementById('recipe-modal').classList.remove('show');
        }

        function closeModal(event) {
            if (event.target.classList.contains('modal')) {
                closeRecipeModal();
            }
        }

        function editRecipe(id) {
            const recipe = recipes.find(r => r.id === id);
            if (!recipe) return;

            document.getElementById('edit-recipe-id').value = recipe.id;
            document.getElementById('recipe-name').value = recipe.name;
            document.getElementById('recipe-category').value = recipe.category;
            document.getElementById('recipe-servings').value = recipe.servings;
            document.getElementById('recipe-prep-time').value = recipe.prepTime === '×œ× ×¦×•×™×Ÿ' ? '' : recipe.prepTime;
            document.getElementById('recipe-instructions').value = recipe.instructions;
            document.getElementById('recipe-notes').value = recipe.notes || '';

            document.getElementById('ingredients-list').innerHTML = '';
            recipe.ingredients.forEach(ing => {
                const ingredientsList = document.getElementById('ingredients-list');
                const ingredientItem = document.createElement('div');
                ingredientItem.className = 'ingredient-item';
                ingredientItem.innerHTML = `
                    <input type="text" placeholder="×©× ×”××¨×›×™×‘" class="ingredient-name" value="${ing.name}" required>
                    <input type="text" placeholder="×›××•×ª" class="ingredient-quantity" value="${ing.quantity}" required>
                    <input type="text" placeholder="×™×—×™×“×”" class="ingredient-unit" value="${ing.unit}" required>
                    <button type="button" class="btn-remove-ingredient" onclick="removeIngredient(this)">ğŸ—‘ï¸</button>
                `;
                ingredientsList.appendChild(ingredientItem);
            });

            if (recipe.image) {
                const preview = document.getElementById('image-preview');
                preview.src = recipe.image;
                preview.classList.add('show');
                document.querySelector('.image-upload-area').classList.add('has-image');
                document.getElementById('upload-text').style.display = 'none';
            }

            switchTab('create');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function deleteRecipe(id) {
            if (confirm('×”×× ×œ××—×•×§ ××ª×›×•×Ÿ ×–×”?')) {
                recipes = recipes.filter(r => r.id !== id);
                localStorage.setItem('recipes', JSON.stringify(recipes));
                loadRecipes();
                updateStats();
                updateCategoryFilter();
                updateCategoriesTab();
                alert('×”××ª×›×•×Ÿ × ××—×§! ğŸ—‘ï¸');
            }
        }

        function filterRecipes() {
            const searchTerm = document.getElementById('search-recipes').value.toLowerCase();
            const categoryFilter = document.getElementById('filter-category').value;
            const servingsFilter = document.getElementById('filter-servings').value;

            const filtered = recipes.filter(recipe => {
                const matchesSearch = recipe.name.toLowerCase().includes(searchTerm);
                const matchesCategory = !categoryFilter || recipe.category === categoryFilter;
                const matchesServings = !servingsFilter || recipe.servings === parseInt(servingsFilter);
                return matchesSearch && matchesCategory && matchesServings;
            });

            const container = document.getElementById('recipes-container');
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ”</div>
                        <h3>×œ× × ××¦××• ×ª×•×¦××•×ª</h3>
                        <p>× ×¡×” ×œ×©× ×•×ª ××ª ×”×¡×™× ×•×Ÿ</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filtered.map(recipe => `
                <div class="recipe-card" onclick="viewRecipe('${recipe.id}')">
                    ${recipe.image ? `<img src="${recipe.image}" class="recipe-card-image" alt="${recipe.name}">` : '<div class="recipe-card-image"></div>'}
                    <div class="recipe-card-content">
                        <div class="recipe-card-header">
                            <div>
                                <h3 class="recipe-card-title">${recipe.name}</h3>
                                <span class="recipe-card-category">${recipe.category}</span>
                                ${recipe.aiGenerated ? '<span class="recipe-card-ai-badge">ğŸ¤– AI</span>' : ''}
                            </div>
                        </div>
                        <p class="recipe-card-servings">ğŸ‘¥ ${recipe.servings} ×¡×•×¢×“×™× | â±ï¸ ${recipe.prepTime} ×“×§×•×ª</p>
                        <p style="color: var(--text-light); font-size: 0.9em;">ğŸ¥• ${recipe.ingredients.length} ××¨×›×™×‘×™×</p>
                        <div class="recipe-card-actions">
                            <button class="recipe-card-btn btn-add-to-shopping" onclick="event.stopPropagation(); addRecipeToShoppingListFromCard('${recipe.id}')">ğŸ›’ ×§× ×™×•×ª</button>
                            <button class="recipe-card-btn btn-view" onclick="event.stopPropagation(); viewRecipe('${recipe.id}')">ğŸ‘ï¸ ×¦×¤×”</button>
                            <button class="recipe-card-btn btn-edit" onclick="event.stopPropagation(); editRecipe('${recipe.id}')">âœï¸ ×¢×¨×•×š</button>
                            <button class="recipe-card-btn btn-delete" onclick="event.stopPropagation(); deleteRecipe('${recipe.id}')">ğŸ—‘ï¸ ××—×§</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateStats() {
            document.getElementById('total-recipes').textContent = recipes.length;
            const uniqueCategories = [...new Set(recipes.map(r => r.category))];
            document.getElementById('total-categories').textContent = uniqueCategories.length;
            const aiRecipes = recipes.filter(r => r.aiGenerated).length;
            document.getElementById('total-ai-recipes').textContent = aiRecipes;
        }

        function updateCategoryFilter() {
            const categories = [...new Set(recipes.map(r => r.category))];
            const filterSelect = document.getElementById('filter-category');
            filterSelect.innerHTML = '<option value="">×›×œ ×”×§×˜×’×•×¨×™×•×ª</option>';
            categories.forEach(cat => {
                filterSelect.innerHTML += `<option value="${cat}">${cat}</option>`;
            });
        }

        function updateCategoriesTab() {
            const categories = [...new Set(recipes.map(r => r.category))];
            const container = document.getElementById('categories-stats');
            
            if (categories.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ·ï¸</div>
                        <h3>××™×Ÿ ×§×˜×’×•×¨×™×•×ª ×¢×“×™×™×Ÿ</h3>
                        <p>×¦×•×¨ ××ª×›×•× ×™× ×œ×¨××•×ª ×¡×˜×˜×™×¡×˜×™×§×•×ª</p>
                    </div>
                `;
                return;
            }

            const categoryColors = [
                'linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%)',
                'linear-gradient(135deg, #4ecdc4 0%, #45b8b0 100%)',
                'linear-gradient(135deg, #ffe66d 0%, #ffd93d 100%)',
                'linear-gradient(135deg, #a8e6cf 0%, #7ec8a3 100%)',
                'linear-gradient(135deg, #ff8b94 0%, #ff7096 100%)',
                'linear-gradient(135deg, #c7ceea 0%, #abb5d6 100%)',
                'linear-gradient(135deg, #ffd3b6 0%, #ffaa85 100%)',
                'linear-gradient(135deg, #dcedc1 0%, #c7e7a0 100%)'
            ];

            container.innerHTML = categories.map((cat, index) => {
                const count = recipes.filter(r => r.category === cat).length;
                const color = categoryColors[index % categoryColors.length];
                return `
                    <div class="recipe-card">
                        <div style="background: ${color}; height: 150px; display: flex; align-items: center; justify-content: center; font-size: 4em;">
                            ${getEmojiForCategory(cat)}
                        </div>
                        <div class="recipe-card-content">
                            <h3 class="recipe-card-title">${cat}</h3>
                            <p style="font-size: 2em; color: var(--primary-color); font-weight: 700; margin: 15px 0;">${count}</p>
                            <p style="color: var(--text-light);">××ª×›×•× ×™× ×‘×§×˜×’×•×¨×™×”</p>
                            <button class="btn btn-primary" style="width: 100%; margin-top: 15px;" onclick="filterByCategory('${cat}')">
                                ×¦×¤×” ×‘××ª×›×•× ×™×
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getEmojiForCategory(category) {
            const emojis = {
                '×¨××©×•× ×•×ª': 'ğŸ¥—',
                '×¢×™×§×¨×™×•×ª': 'ğŸ–',
                '×ª×•×¡×¤×•×ª': 'ğŸ¥”',
                '×§×™× ×•×—×™×': 'ğŸ°',
                '×¡×œ×˜×™×': 'ğŸ¥™',
                '××¨×§×™×': 'ğŸ²',
                '××¤×™×™×”': 'ğŸ¥',
                '××©×§××•×ª': 'ğŸ¹'
            };
            return emojis[category] || 'ğŸ½ï¸';
        }

        function filterByCategory(category) {
            switchTab('recipes');
            document.getElementById('filter-category').value = category;
            filterRecipes();
        }

        function exportRecipe() {
            const recipe = recipes.find(r => r.id === currentRecipeId);
            if (!recipe) return;

            const recipeText = `
${recipe.name}
${'='.repeat(recipe.name.length)}
${recipe.aiGenerated ? 'ğŸ¤– ×–×•×”×” ×¢"×™ Gemini AI' : ''}

×§×˜×’×•×¨×™×”: ${recipe.category}
×¡×•×¢×“×™×: ${recipe.servings}
×–××Ÿ: ${recipe.prepTime} ×“×§×•×ª

××¨×›×™×‘×™×:
${recipe.ingredients.map(ing => `â€¢ ${ing.quantity} ${ing.unit} ${ing.name}`).join('\n')}

×”×•×¨××•×ª:
${recipe.instructions}

${recipe.notes ? `×˜×™×¤×™×:\n${recipe.notes}` : ''}

---
××™×¦×¨ ××ª×›×•× ×™× AI + ×¨×©×™××ª ×§× ×™×•×ª
            `.trim();

            const blob = new Blob([recipeText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${recipe.name}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('ğŸ“¥ ×”××ª×›×•×Ÿ ×™×•×¦×!');
        }

        // Drag and drop
        const aiUploadArea = document.getElementById('ai-upload-area');
        
        aiUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            aiUploadArea.style.borderColor = 'white';
        });

        aiUploadArea.addEventListener('dragleave', () => {
            aiUploadArea.style.borderColor = 'rgba(255, 255, 255, 0.5)';
        });

        aiUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            aiUploadArea.style.borderColor = 'rgba(255, 255, 255, 0.5)';
            
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                const input = document.getElementById('ai-image-input');
                input.files = e.dataTransfer.files;
                handleAIImageUpload({ target: input });
            }
        });

        const uploadArea = document.querySelector('.image-upload-area');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = 'var(--primary-color)';
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.borderColor = '#e0e0e0';
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#e0e0e0';
            
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                const input = document.getElementById('recipe-image');
                input.files = e.dataTransfer.files;
                previewImage({ target: input });
            }
        });
    </script>
</body>
</html>
